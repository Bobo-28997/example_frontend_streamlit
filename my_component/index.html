<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Streamlit Component</title>
    <style>
        body { font-family: sans-serif; padding: 1rem; background: transparent; }
        .card { 
            background: white; border: 1px solid #e0e0e0; 
            border-radius: 0.5rem; padding: 1rem; 
            box-shadow: 0 1px 2px rgba(0,0,0,0.05);
        }
        button {
            background-color: #ff4b4b; color: white; border: none;
            padding: 0.5rem 1rem; border-radius: 0.25rem; cursor: pointer;
        }
        button:hover { background-color: #ff2b2b; }
        #debug { margin-top: 10px; font-size: 0.8rem; color: #666; font-family: monospace; }
        .success { color: green; font-weight: bold; }
    </style>
</head>
<body>
    <div class="card">
        <h3>ğŸ‘‹ Hello, <span id="name-display">...</span></h3>
        <button id="btn">å‘é€æ•°æ®åˆ° Python</button>
        <div id="debug">ç­‰å¾…è¿æ¥...</div>
    </div>

    <script>
    (function(){var e="streamlit:componentReady",t="streamlit:render",n="streamlit:setComponentValue",i="streamlit:setFrameHeight";function o(e){var t=e.data,n=e.source;if(n===window.parent){var i=t.type;if("streamlit:render"===i){var o=t.args;window.Streamlit.onRender&&window.Streamlit.onRender(o)}}}function a(e){window.parent.postMessage(e,window.Streamlit.streamlitUrl)}window.Streamlit={streamlitUrl:null,onRender:null,setComponentReady:function(){a({type:e,apiVersion:1})},setComponentValue:function(e){a({type:n,value:e})},setFrameHeight:function(e){void 0===e&&(e=document.body.scrollHeight),a({type:i,height:e})}},function(){var e=window.location.search;if(e){var t=new URLSearchParams(e).get("streamlitUrl");t&&(window.Streamlit.streamlitUrl=t,window.addEventListener("message",o),window.Streamlit.setComponentReady())}}()})();
    </script>

    <script>
        const nameDisplay = document.getElementById("name-display");
        const debug = document.getElementById("debug");
        const btn = document.getElementById("btn");

        // 1. è®¾ç½®å›è°ƒå‡½æ•°
        window.Streamlit.onRender = function(args) {
            // æ¥æ”¶ Python ä¼ æ¥çš„å‚æ•°
            const name = args.name || "World";
            nameDisplay.textContent = name;
            debug.innerHTML = `çŠ¶æ€: <span class="success">å·²è¿æ¥ (Token: ${Date.now()})</span>`;
            
            // è‡ªåŠ¨è°ƒæ•´é«˜åº¦
            window.Streamlit.setFrameHeight();
        };

        // 2. ç»‘å®šæŒ‰é’®äº‹ä»¶
        btn.onclick = function() {
            const msg = `Clicked at ${new Date().toLocaleTimeString()}`;
            debug.textContent = `æ­£åœ¨å‘é€: ${msg}`;
            window.Streamlit.setComponentValue(msg);
        };
        
        // æ³¨æ„ï¼šå®˜æ–¹åº“ï¼ˆä¸Šé¢çš„ minified scriptï¼‰ä¼šè‡ªåŠ¨è°ƒç”¨ setComponentReady()
        // æ‰€ä»¥è¿™é‡Œä¸éœ€è¦æ‰‹åŠ¨è°ƒç”¨å®ƒï¼Œåªéœ€è¦å®šä¹‰ onRender å³å¯ã€‚
        
        debug.textContent = "è„šæœ¬å·²åŠ è½½ï¼Œç­‰å¾… Streamlit æ¡æ‰‹...";
    </script>
</body>
</html>
